# ---------------------------------------------
# Docker Compose Configuration File
# ---------------------------------------------

# This Docker Compose file defines and configures the services required to run
# the FastAPI Calculator application, a PostgreSQL database, and pgAdmin.

# Services Definition
services:
  # ---------------------------------------------
  # Service: web (Your FastAPI App)
  # ---------------------------------------------
  web:
    build: .
    container_name: fastapi_calculator
    ports:
      - "8000:8000"
    volumes:
      - .:/app
    environment:
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - db  # <-- ADDED: This tells Docker to wait for the 'db' service to start first.

  # ---------------------------------------------
  # Service: db (PostgreSQL Database)
  # ---------------------------------------------
  db:
    image: postgres:15-alpine
    container_name: postgres_db
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=mypassword  # Use this password in pgAdmin
      - POSTGRES_DB=fastapi_db        # The database for your assignment
    ports:
      - "5432:5432" # Exposes the database port to your host machine
    volumes:
      - postgres_data:/var/lib/postgresql/data # Persists database data

  # ---------------------------------------------
  # Service: pgadmin (Database Admin Tool)
  # ---------------------------------------------
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin_service
    environment:
      - PGADMIN_DEFAULT_EMAIL=admin@example.com # Use this to log in
      - PGADMIN_DEFAULT_PASSWORD=admin          # Use this to log in
    ports:
      - "5050:80" # Access pgAdmin at http://localhost:5050
    depends_on:
      - db # This tells Docker to wait for the 'db' service to start first

# ---------------------------------------------
# Volumes Definition
# ---------------------------------------------
volumes:
  postgres_data: # This named volume stores your database data